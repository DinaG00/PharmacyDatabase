CREATE TABLE PHARMACEUTICAL_FORM
(
    PHARMACEUTICAL_FORM_ID NUMBER(10) CONSTRAINT PHARMACEUTICAL_FORM_PK PRIMARY KEY,
    PHARMACEUTICAL_FORM_NAME VARCHAR2(50) NOT NULL
);

CREATE TABLE PRODUCERS
(
    PRODUCER_ID NUMBER(10) CONSTRAINT PRODUCER_PK PRIMARY KEY,
    PRODUCER_NAME VARCHAR2(50)
);

CREATE TABLE ITEMS
(
    ITEM_ID NUMBER(10) CONSTRAINT PK_ITEMS PRIMARY KEY,
    ITEM_TYPE VARCHAR2(30) CONSTRAINT ITYPE CHECK (ITEM_TYPE IN ('DRUG','OTC','PARAPHARMACEUTICAL','COSMETICS','HERBAL','PEDIATRIC','SANITARY')),
    ITEM_NAME VARCHAR2(50) NOT NULL,
    ACTIVE_SUBSTANCE VARCHAR2(50),
    CONCENTRATION VARCHAR2(10),
    PHARMACEUTICAL_FORM_ID NUMBER(10) REFERENCES PHARMACEUTICAL_FORM (PHARMACEUTICAL_FORM_ID),
    QTY_PER_PACKAGE NUMBER(3),
    PRODUCER VARCHAR2(50),
    VAT_PERCENT NUMBER(4,2)
);

CREATE TABLE GRN
(
    GRN_ID NUMBER(10) CONSTRAINT GRN_PK PRIMARY KEY,
    GRN_NO NUMBER(10),
    GRN_DATE DATE DEFAULT SYSDATE,
    INVOICE_NO NUMBER(10),
    INVOICE_DATE DATE,
    PRODUCER_ID NUMBER(10) REFERENCES PRODUCERS(PRODUCER_ID),
    GRN_VALUE NUMBER(16,2),
    VAT_VALUE NUMBER(16,2),
    PAYMENT_TERM DATE,
    MARK_UP NUMBER(16,2)
);

CREATE TABLE GRN_DETAILED
(
    ID NUMBER(10) CONSTRAINT GRN_DETAILED_PK PRIMARY KEY,
    GRN_ID NUMBER(10) REFERENCES GRN(GRN_ID),
    ITEM_ID NUMBER(10) REFERENCES ITEMS(ITEM_ID),
    EXPIRATION_DATE DATE,
    QTY_PER_PACKAGE NUMBER(3),
    QTY_PER_UNIT NUMBER(4),
    PRICE NUMBER(16,2),
    DETAILED_PRICE NUMBER(16,2),
    VAT_PERCENT NUMBER(4,2)
);

CREATE TABLE DISEASE
(
    DISEASE_ID NUMBER(10) CONSTRAINT DISEASE_PK PRIMARY KEY ,
    DISEASE_NAME VARCHAR2(50)
);

CREATE TABLE RECOMMENDATIONS
(
    DISEASE_ID REFERENCES DISEASE(DISEASE_ID),
    ITEM_ID REFERENCES ITEMS(ITEM_ID),
    DOSE NUMBER(5)
);

CREATE TABLE PHARMACEUTIST
(
    PHARMACEUTIST_ID NUMBER(10) CONSTRAINT PHARMACEUTIST_PK PRIMARY KEY,
    FIRST_NAME VARCHAR2(30) CONSTRAINT FNAMES UNIQUE,
    LAST_NAME VARCHAR2(30) CONSTRAINT LNAMES UNIQUE,
    PHONE VARCHAR2(20),
    ADRESS VARCHAR2(50),
    BANK_ACC VARCHAR2(20),
    BANK_NAME VARCHAR2(20),
    MALPRAXIS_INSURANCE_NO NUMBER(15),
    SALARY NUMBER(16,2),
    ACTIVE_STATUS CHAR(1) CONSTRAINT ACTIVE_STAT CHECK (ACTIVE_STATUS IN ('Y','N'))
);

CREATE TABLE PATIENTS
(
    ID NUMBER(10) CONSTRAINT PATIENTS_PK PRIMARY KEY,
    FIRST_NAME VARCHAR2(30) NOT NULL,
    LAST_NAME VARCHAR2(30) NOT NULL,
    PHONE VARCHAR2(20),
    EMAIL VARCHAR2(50),
    BIRTH_DATE DATE,
    CARN_NO NUMBER(10),
    SOLD NUMBER (16,2)
);

CREATE TABLE SALES
(
    SALE_ID NUMBER(10) CONSTRAINT PK_SALES PRIMARY KEY,
    SALE_DATE DATE DEFAULT SYSDATE,
    SALE_VALUE NUMBER(16,2),
    VAT_VALUE NUMBER(16,2),
    FISCAL_RECEIPT_PRINTED CHAR(1) CONSTRAINT FRP CHECK ( FISCAL_RECEIPT_PRINTED IN ('Y','N')),
    PATIENT_ID REFERENCES PATIENTS(ID),
    PHARMACEUTIST_ID REFERENCES PHARMACEUTIST(PHARMACEUTIST_ID)
);

CREATE TABLE SALES_DETAILED
(
    ID NUMBER(10) CONSTRAINT PK_SALES_DETAILED PRIMARY KEY,
    SALE_ID REFERENCES SALES(SALE_ID),
    ITEM_ID REFERENCES ITEMS(ITEM_ID),
    QTY_PER_PACKAGE NUMBER(3),
    QTY_PER_UNIT NUMBER(4),
    PRICE NUMBER(16,2)
);

CREATE TABLE PRESCRIPTIONS_DETAILED
(
    ID NUMBER(10) CONSTRAINT PK_PRESCRIPTIONS_DETAILED PRIMARY KEY,
    ITEM_ID REFERENCES ITEMS(ITEM_ID),
    SALE_ID REFERENCES SALES(SALE_ID),
    POSITION NUMBER(2),
    DRUG_TYPE VARCHAR2(50),
    DIAGNOSIS_TYPE VARCHAR2(50),
    REFERENCE_PRICE NUMBER(16,2),
    COMPENSATION_PERCENT NUMBER(5,2),
    DISEASE_ID NUMBER(10) REFERENCES DISEASE(DISEASE_ID)
);

CREATE TABLE PRESCRIPTIONS 
(
    SALE_ID NUMBER(10) CONSTRAINT PK_PRESCRIPTIONS PRIMARY KEY REFERENCES SALES(SALE_ID),
    PRESCRIPTION_NUMBER NUMBER(10) NOT NULL,
    SERIES VARCHAR2(6) NOT NULL,
    NO NUMBER(6) NOT NULL,
    DATE_PRESCRIBED DATE,
    DATE_SALE DATE DEFAULT SYSDATE,
    PATIENT_TYPE VARCHAR2(30),
    CID NUMBER(15) NOT NULL,
    PHYSICIAN VARCHAR2(60),
    SOURCE VARCHAR2(20) 
);
-- TABLE ITEMS
INSERT INTO ITEMS(ITEM_ID,ITEM_TYPE,ITEM_NAME,QTY_PER_PACKAGE,PRODUCER,VAT_PERCENT) VALUES (1005,'PARAPHARMACEUTICAL','PANTENE',500,'JOHNSON',19);
INSERT INTO ITEMS(ITEM_ID,ITEM_TYPE,ITEM_NAME,QTY_PER_PACKAGE,PRODUCER,VAT_PERCENT) VALUES (1225,'DRUG','ARCOXIA',90,'MERCK',9.0);
INSERT INTO ITEMS(ITEM_ID,ITEM_TYPE,ITEM_NAME,QTY_PER_PACKAGE,PRODUCER,VAT_PERCENT) VALUES (1495,'DRUG','CLORZOXAZONA',25,'RICHTER',9.0);
INSERT INTO ITEMS(ITEM_ID,ITEM_TYPE,ITEM_NAME,QTY_PER_PACKAGE,PRODUCER,VAT_PERCENT) VALUES (154,'DRUG','KETONAL DUO',150,'LEK',19.0);
INSERT INTO ITEMS(ITEM_ID,ITEM_TYPE,ITEM_NAME,QTY_PER_PACKAGE,PRODUCER,VAT_PERCENT) VALUES (249,'COSMETICS','AVENE MICELLAR WATER',500,'AVENE',19.0);
INSERT INTO ITEMS(ITEM_ID,ITEM_TYPE,ITEM_NAME,QTY_PER_PACKAGE,PRODUCER,VAT_PERCENT) VALUES (394,'HERBAL','GREEN TEA',100,'PLARIS',19.0);
INSERT INTO ITEMS VALUES (224,'DRUG','AUGUMENTIN','AMOXICILINA+ACID CLAVILANIC',1000,2,30,'PLARIS',19.0);
INSERT INTO ITEMS VALUES (114,'DRUG','NORMIX','ACID RIFAXIMINUM',150,14,56,'PLARIS',9.0);
INSERT INTO ITEMS VALUES (124,'OTC','OSTEOCARE','CALCIU D+MAG+VIT K',100,16,20,'MYLLAN',19.0);
INSERT INTO ITEMS VALUES (324,'PEDIATRIC','OLINTH','XINOMETAZOLIN',0.5,19,10,'PLARIS',9.0);
INSERT INTO ITEMS VALUES (424,'DRUG','FERRUM HAUSMAN','HIDROXID DE FIER',0.5,5,200,'VIFOR',9.0);
INSERT INTO ITEMS VALUES (524,'DRUG','AUGUMENTIN','AMOXICILINA+ACID CLAVILANIC',1000,2,30,'PLARIS',19.0);
INSERT INTO ITEMS VALUES (83628,'DRUG','AZITROX 200MG/5ML','AZITHROMYCINUM',200,1,5,'ZENDIVA',9.0);
INSERT INTO ITEMS VALUES (86351,'DRUG','AZITROX 500MG','AZITHROMYCINUM',500,1,5,'ZENDIVA',9.0);
INSERT INTO ITEMS VALUES (72635,'DRUG','BENEFIX 1000UI','NONACOG ALFA FACTOR IX COAGULARE RECOMBINANT',1000,24,2,'MERCK',9.0);
INSERT INTO ITEMS VALUES (91263,'DRUG','BELARA 2MG','CLORMADINONA+ETINILESTRADIOL',2,3,30,'MERCK',9.0);
INSERT INTO ITEMS VALUES (81273,'DRUG','CEFALEXINA 200MG','CEFALEXINUM',200,3,10,'RICHTER',9.0);
INSERT INTO ITEMS VALUES (20183,'DRUG','CEFALEXINA 300MG','CEFALEXINUM',300,3,10,'RICHTER',9.0);
INSERT INTO ITEMS VALUES (27362,'DRUG','CEFALEXINA 500MG','CEFALEXINUM',500,3,10,'RICHTER',9.0);
INSERT INTO ITEMS VALUES (27389,'DRUG','CEFALEXINA 300MG','CEFALEXINUM',300,3,10,'TERAPIA',9.0);
INSERT INTO ITEMS VALUES (1937,'DRUG','ACIFOL 5MG','ACIDUM FOLICUM',5,18,20,'PHEIZER',9.0);
INSERT INTO ITEMS VALUES (817,'DRUG','VENTOLIN','SALBUTAMOLUM',5,13,100,'BOIRON',9.0);
INSERT INTO ITEMS VALUES (818,'DRUG','VENTOLIN','SALBUTAMOLUM',5,13,200,'BOIRON',9.0);

SELECT * FROM ITEMS;
DESCRIBE ITEMS;

--TABLE DISEASE
INSERT INTO DISEASE VALUES (1,'FLU');
INSERT INTO DISEASE VALUES (2,'GASTRITIES');
INSERT INTO DISEASE VALUES (3,'ULCER');
INSERT INTO DISEASE VALUES (4,'PAIN');
INSERT INTO DISEASE VALUES (5,'HIGH BLOOD PRESSURE');
INSERT INTO DISEASE VALUES (6,'ARTHRITIS');
INSERT INTO DISEASE VALUES (7,'DIARRHEA');
INSERT INTO DISEASE VALUES (8,'CIRRHOSIS');
INSERT INTO DISEASE VALUES (9,'ANEMIA');
INSERT INTO DISEASE VALUES (10,'OSTEOPOROSIS');
INSERT INTO DISEASE VALUES (11,'ASTHMA');

--TABLE PHARMACEUTIST
INSERT INTO PHARMACEUTIST VALUES (12,'IOANA','POPESCU','078648733','BUC,STR ION,NR 16','755784478','BANCA TRANSILVANIA',98376724,9500,'Y');
INSERT INTO PHARMACEUTIST VALUES (32,'ANDREI','GEORGESCU','078374933','BUC,BD. GEN. BONAN,NR 76','7938474478','ING',3948276724,9200,'Y');
INSERT INTO PHARMACEUTIST VALUES (15,'MATEI','ION','079753680','BUC,STR MANEA,NR 3','9775784492','BANCA TRANSILVANIA',76576963,7800,'N');
INSERT INTO PHARMACEUTIST VALUES (2,'MARIA','TANASE','078627934','BUC,STR MORII,NR 81','RFB975084478','RAIFFEISEN BANK',864789042,9900,'Y');
INSERT INTO PHARMACEUTIST VALUES (82,'CRISTIAN','CIUVAT','0745421560','BUC,STR TOPORASI,NR 75','864380864','ING',86533790,9900,'N');

--TABLE PATIENTS
INSERT INTO PATIENTS VALUES (1,'DINA','GAVRILESCU','078853567','GAVRILESCUDINA22@STUD.ASE.RO',TO_DATE('24-JAN-2000', 'DD-MON-YYYY'),764369,1500.57);
INSERT INTO PATIENTS VALUES (15,'IONUT','SPATARU','07362846538','SPATARUKDJOF@GMAIL.COM',TO_DATE('15-MAY-1993', 'DD-MON-YYYY'),9457932,8760.87);
INSERT INTO PATIENTS VALUES (8,'GEORGE','GEREA','07348929345','SPATARUKDJOF@GMAIL.COM',TO_DATE('12-APR-1983', 'DD-MON-YYYY'),87593035,12760.13);
INSERT INTO PATIENTS VALUES (11,'ANDREEA','MILEA','0726391645','ANDREEAM@GMAIL.COM',TO_DATE('18-SEP-1993', 'DD-MON-YYYY'),8475302,5760.29);
INSERT INTO PATIENTS VALUES (3,'MIRELA','MIHALESCU','072985635','MIRELAATA@GMAIL.COM',TO_DATE('15-JUN-1997', 'DD-MON-YYYY'),7463829,760.65);
INSERT INTO PATIENTS VALUES (29,'ANCA','STOICA','0748394526','STOICAANCA@GMAIL.COM',TO_DATE('22-MAY-1999', 'DD-MON-YYYY'),47583924,5760.03);
INSERT INTO PATIENTS VALUES (6,'MIRCEA','STROE','+228394725432','STROEULMIRCEAUL@GMAIL.COM',TO_DATE('12-JUL-1990', 'DD-MON-YYYY'),47583924,82260.23);
INSERT INTO PATIENTS VALUES (19,'RADU','APOSTOL','+999083756438','RADUAPOSTOL@GMAIL.COM',TO_DATE('15-DEC-1975', 'DD-MON-YYYY'),746372946,2360.77);

--TABLE PRODUCERS
INSERT INTO PRODUCERS VALUES (1,'MERCK');
INSERT INTO PRODUCERS VALUES (2,'CLAXO');
INSERT INTO PRODUCERS VALUES (3,'PHEIZER');
INSERT INTO PRODUCERS VALUES (4,'SERVIER');
INSERT INTO PRODUCERS VALUES (5,'BOIRON');
INSERT INTO PRODUCERS VALUES (6,'TERAPIA');
INSERT INTO PRODUCERS VALUES (7,'ZENDIVA');
INSERT INTO PRODUCERS VALUES (8,'BIOPHARM');
INSERT INTO PRODUCERS VALUES (9,'RICHTER');
INSERT INTO PRODUCERS VALUES (10,'APOTT');

--TABLE GRN
INSERT INTO GRN VALUES (1,2743,TO_DATE('20-NOV-2023', 'DD-MON-YYYY'),12342,TO_DATE('22-NOV-2023', 'DD-MON-YYYY'),3,2300.18,19,TO_DATE('22-DEC-2023', 'DD-MON-YYYY'),300);
INSERT INTO GRN VALUES (2,8384,TO_DATE('28-NOV-2023', 'DD-MON-YYYY'),93747,TO_DATE('30-NOV-2023', 'DD-MON-YYYY'),5,8506.36,9,TO_DATE('05-JAN-2023', 'DD-MON-YYYY'),280);
INSERT INTO GRN VALUES (3,2384,TO_DATE('10-NOV-2023', 'DD-MON-YYYY'),83756,TO_DATE('15-NOV-2023', 'DD-MON-YYYY'),1,9845.35,9,TO_DATE('28-DEC-2023', 'DD-MON-YYYY'),900);
INSERT INTO GRN VALUES (4,8475,TO_DATE('27-OCT-2023', 'DD-MON-YYYY'),24857,TO_DATE('28-OCT-2023', 'DD-MON-YYYY'),6,10023.86,9,TO_DATE('01-DEC-2023', 'DD-MON-YYYY'),760.15);
INSERT INTO GRN VALUES (5,7455,TO_DATE('12-OCT-2023', 'DD-MON-YYYY'),13726,TO_DATE('13-OCT-2023', 'DD-MON-YYYY'),2,3002.71,9,TO_DATE('01-NOV-2023', 'DD-MON-YYYY'),450.17);
INSERT INTO GRN VALUES (6,1938,TO_DATE('15-DEC-2023', 'DD-MON-YYYY'),19923,TO_DATE('19-DEC-2023', 'DD-MON-YYYY'),8,2000.19,9,TO_DATE('5-JAN-2023', 'DD-MON-YYYY'),214.89);
INSERT INTO GRN VALUES (7,1237,TO_DATE('17-DEC-2023', 'DD-MON-YYYY'),10034,TO_DATE('19-DEC-2023', 'DD-MON-YYYY'),4,9799.36,9,TO_DATE('30-JAN-2023', 'DD-MON-YYYY'),1134.16);
INSERT INTO GRN VALUES (8,3922,TO_DATE('17-JUL-2023', 'DD-MON-YYYY'),29003,TO_DATE('20-JUL-2023', 'DD-MON-YYYY'),10,8560.16,9,TO_DATE('27-AUG-2023', 'DD-MON-YYYY'),1048.78);
INSERT INTO GRN VALUES (9,3882,TO_DATE('18-DEC-2023', 'DD-MON-YYYY'),29003,TO_DATE('20-DEC-2023', 'DD-MON-YYYY'),10,8560.16,9,TO_DATE('27-JAN-2024', 'DD-MON-YYYY'),1048.78);
INSERT INTO GRN VALUES (9,3882,TO_DATE('18-DEC-2023', 'DD-MON-YYYY'),29003,TO_DATE('20-DEC-2023', 'DD-MON-YYYY'),10,8560.16,9,TO_DATE('27-JAN-2024', 'DD-MON-YYYY'),1048.78);
DESCRIBE GRN;

--TABLE GRN_DETAILED
INSERT INTO GRN_DETAILED VALUES (1,1,1495,TO_DATE('01-12-2028','DD-MM-YYYY'),25,80,28.76,32,9);
INSERT INTO GRN_DETAILED VALUES (2,2,424,TO_DATE('01-08-2027','DD-MM-YYYY'),200,50,85.06,89.9,9);
INSERT INTO GRN_DETAILED VALUES (3,2,1625,TO_DATE('30-10-2029','DD-MM-YYYY'),30,250,17.01,19.5,9);
INSERT INTO GRN_DETAILED VALUES (4,6,524,TO_DATE('01-12-2030','DD-MM-YYYY'),30,45,44.45,50,9);
INSERT INTO GRN_DETAILED VALUES(5,3,27362,TO_DATE('01-12-2026','DD-MM-YYYY'),10,130,75.73,89.9,9);
INSERT INTO GRN_DETAILED VALUES(6,4,249,TO_DATE('01-10-2029','DD-MM-YYYY'),500,120,83.53,95.9,9);
INSERT INTO GRN_DETAILED VALUES(7,5,1005,TO_DATE('01-08-2030','DD-MM-YYYY'),500,65,30.77,41.3,9);
INSERT INTO GRN_DETAILED VALUES(8,7,1625,TO_DATE('01-12-2030','DD-MM-YYYY'),30,250,19.60,23,9);
INSERT INTO GRN_DETAILED VALUES(9,7,1615,TO_DATE('01-07-2029','DD-MM-YYYY'),30,200,24.50,28.50,9);
INSERT INTO GRN_DETAILED VALUES(10,8,27362,TO_DATE('01-12-2026','DD-MM-YYYY'),10,30,71.33,76.50,9);
INSERT INTO GRN_DETAILED VALUES(11,8,27389,TO_DATE('01-12-2026','DD-MM-YYYY'),10,25,85.60,89.9,9);
INSERT INTO GRN_DETAILED VALUES(12,8,20183,TO_DATE('01-12-2026','DD-MM-YYYY'),10,35,61.15,70.00,9);
INSERT INTO GRN_DETAILED VALUES(13,8,1937,TO_DATE('01-12-2026','DD-MM-YYYY'),20,50,42.80,49.9,9);
INSERT INTO GRN_DETAILED VALUES(14,9,27389,TO_DATE('01-11-2026','DD-MM-YYYY'),10,25,85.60,89.9,9);
INSERT INTO GRN_DETAILED VALUES(15,9,20183,TO_DATE('01-03-2027','DD-MM-YYYY'),10,35,61.15,70.00,9);
INSERT INTO GRN_DETAILED VALUES(16,9,1937,TO_DATE('01-12-2027','DD-MM-YYYY'),20,50,42.80,49.9,9);


DESCRIBE GRN_DETAILED;

--TABLE SALES:
INSERT INTO SALES VALUES(110,TO_DATE('10.10.2023','DD.MM.YYYY'),58.5,5.27,'Y',8,2); --3X 1625 19.5 LEI
INSERT INTO SALES VALUES(113,TO_DATE('10.10.2023','DD.MM.YYYY'),280.9,25.28,'Y',1,12); --2X 249 95.5 + 424 89.9
INSERT INTO SALES VALUES(115,TO_DATE('10.10.2023','DD.MM.YYYY'),17.98,1.62,'N',3,12); -- 27389 X 5 PASTILE IE : 5
INSERT INTO SALES VALUES(118,TO_DATE('11.10.2023','DD.MM.YYYY'),70.4,8.93,'Y',29,32); --2X 1495 32 + 5P 1495 6.4
INSERT INTO SALES VALUES(7772,TO_DATE('12.10.2023','DD.MM.YYYY'),3.3,0,'Y',29,32);
DESCRIBE SALES;

--TABLE SALES_DETAILED : 
INSERT INTO SALES_DETAILED(ID,SALE_ID,ITEM_ID,QTY_PER_UNIT,PRICE) VALUES (1,110,1625,3,58.5);
INSERT INTO SALES_DETAILED(ID,SALE_ID,ITEM_ID,QTY_PER_UNIT,PRICE) VALUES (2,113,249,2,191);
INSERT INTO SALES_DETAILED(ID,SALE_ID,ITEM_ID,QTY_PER_UNIT,PRICE) VALUES (3,113,424,1,89.9);
INSERT INTO SALES_DETAILED(ID,SALE_ID,ITEM_ID,QTY_PER_PACKAGE,PRICE) VALUES (4,115,27389,5,17.98);
INSERT INTO SALES_DETAILED VALUES (5,118,1495,5,2,70.4);

DESCRIBE SALES_DETAILED;

--TABLE PRESCRIPTIONS:
--CHILD, RETIRED, EMPLOYED, DIABETIC |||| MEDIC DE FAMILIE, SPITAL, AMBULATORIU
INSERT INTO PRESCRIPTIONS VALUES(7772,2243,'WA9304',55692,TO_DATE('20-11-2023','DD-MM-YYYY'),TO_DATE('24-11-2023','DD-MM-YYYY'),'CHILD',928376462,'MIRELA OANCEA','MD');
DESCRIBE PRESCRIPTIONS;

--TABLE PRESCRIPTIONS_DETAILED:
INSERT INTO PRESCRIPTIONS_DETAILED VALUES(1,817,7772,1,'COMPENSAT','CHRONIC',3.3,87.3,11);
DESCRIBE PRESCRIPTIONS_DETAILED;

--TABLE RECOMMENDATIONS:
INSERT INTO RECOMMENDATIONS VALUES(11,817,1);
DESCRIBE ALTER TABLE GRN 
RENAME COLUMN VAT_VALUE 
TO VAT_PERCENT;

ALTER TABLE ITEMS
DROP COLUMN PRODUCER;

ALTER TABLE ITEMS
ADD PRODUCER_ID NUMBER(10);

ALTER TABLE ITEMS
ADD CONSTRAINT FK_ITEMS_PRODUCER FOREIGN KEY(PRODUCER_ID) 
REFERENCES PRODUCERS(PRODUCER_ID);

SELECT GD.ITEM_ID, G.PRODUCER_ID
FROM GRN G, GRN_DETAILED GD
WHERE G.GRN_ID = GD.GRN_ID;

UPDATE ITEMS
SET PRODUCER_ID = 3
WHERE ITEM_ID = 1495;
UPDATE ITEMS
SET PRODUCER_ID = 5
WHERE ITEM_ID = 1625;
UPDATE ITEMS
SET PRODUCER_ID = 5
WHERE ITEM_ID = 424;
UPDATE ITEMS
SET PRODUCER_ID = 2
WHERE ITEM_ID = 1005;
UPDATE ITEMS
SET PRODUCER_ID = 8
WHERE ITEM_ID = 524;
UPDATE ITEMS
SET PRODUCER_ID = 4
WHERE ITEM_ID = 1625;
UPDATE ITEMS
SET PRODUCER_ID = 1
WHERE ITEM_ID = 1937;
UPDATE ITEMS
SET PRODUCER_ID = 10
WHERE ITEM_ID = 27362;
UPDATE ITEMS
SET PRODUCER_ID = 6
WHERE ITEM_ID = 249;
UPDATE ITEMS
SET PRODUCER_ID = 4
WHERE ITEM_ID = 1615;
UPDATE ITEMS
SET PRODUCER_ID = 10
WHERE ITEM_ID = 20183;
UPDATE ITEMS
SET PRODUCER_ID = 10
WHERE ITEM_ID = 27389;
UPDATE ITEMS
SET PRODUCER_ID = 4
WHERE ITEM_ID = 818;
UPDATE ITEMS
SET PRODUCER_ID = 5
WHERE ITEM_ID = 91263;
UPDATE ITEMS
SET PRODUCER_ID = 4
WHERE ITEM_ID = 1865;
UPDATE ITEMS
SET PRODUCER_ID = 5
WHERE ITEM_ID = 124;
UPDATE ITEMS
SET PRODUCER_ID = 6
WHERE ITEM_ID = 1865;
UPDATE ITEMS
SET PRODUCER_ID = 7
WHERE ITEM_ID = 114;
UPDATE ITEMS
SET PRODUCER_ID = 8
WHERE ITEM_ID = 72635;
UPDATE ITEMS
SET PRODUCER_ID = 9 
WHERE ITEM_ID = 154;
UPDATE ITEMS
SET PRODUCER_ID = 10
WHERE ITEM_ID = 1225;
UPDATE ITEMS
SET PRODUCER_ID = 10
WHERE ITEM_ID = 81273;
UPDATE ITEMS
SET PRODUCER_ID = 1
WHERE ITEM_ID = 394;
UPDATE ITEMS
SET PRODUCER_ID = 2
WHERE ITEM_ID = 83628;
UPDATE ITEMS
SET PRODUCER_ID = 3
WHERE ITEM_ID = 224 ;
UPDATE ITEMS
SET PRODUCER_ID = 3
WHERE ITEM_ID = 817;
UPDATE ITEMS
SET PRODUCER_ID = 7
WHERE ITEM_ID = 86351;

ALTER TABLE GRN_DETAILED
DROP COLUMN QTY_PER_PACKAGE;

ALTER TABLE GRN_DETAILED
RENAME COLUMN QTY_PER_UNIT TO QUANTITY; 

--THE TOTAL VALUE OF GOODS RECEIVED FROM EACH PRODUCER, IN EACH MONTH
SELECT (EXTRACT(MONTH FROM G.INVOICE_DATE)) AS INVOICE_MONTH,P.PRODUCER_NAME, SUM(G.GRN_VALUE) AS TOTAL_VALUE 
FROM GRN G, PRODUCERS P
WHERE G.PRODUCER_ID=P.PRODUCER_ID
GROUP BY (EXTRACT(MONTH FROM G.INVOICE_DATE)),P.PRODUCER_NAME
ORDER BY INVOICE_MONTH;

--PRODUCTS THAT EXPIRE BY THE END OF 2026
SELECT I.ITEM_NAME, G.EXPIRATION_DATE, SUM(G.QUANTITY)
FROM ITEMS I, GRN_DETAILED G
WHERE I.ITEM_ID=G.ITEM_ID AND (EXTRACT(YEAR FROM G.EXPIRATION_DATE) <= 2026)
GROUP BY I.ITEM_NAME, G.EXPIRATION_DATE;

--SOLD VALUE FOR EACH PATIENT
SELECT CONCAT(CONCAT(P.FIRST_NAME, ' '),P.LAST_NAME) AS PATIENT_NAME, SUM(S.SALE_VALUE) AS SOLD_VALUE
FROM PATIENTS P, SALES S
WHERE P.ID=S.PATIENT_ID
GROUP BY P.FIRST_NAME, P.LAST_NAME;

--HOW MANY SALES DOES EACH ACTIVE EMPLOYEE HAVE
SELECT COUNT(S.SALE_ID) AS NUMBER_OF_SALE, CONCAT(CONCAT(P.FIRST_NAME, ' '),P.LAST_NAME) AS PHARMACEUTIST_NAME
FROM SALES S, PHARMACEUTIST P
WHERE P.PHARMACEUTIST_ID=S.PHARMACEUTIST_ID AND P.ACTIVE_STATUS='Y'
GROUP BY P.FIRST_NAME,P.LAST_NAME;

--WHAT DO WE HAVE TO PAY UNTIL THE END OF THE YEAR
SELECT SUM(GRN_VALUE) AS VALUE
FROM GRN
WHERE PAYMENT_TERM BETWEEN TO_DATE('31-10-2023','DD,MM,YYYY') AND TO_DATE('01-01-2024','DD-MM-YYYY');

--ITEMS WITH NO SALES
SELECT I.ITEM_NAME, G.ITEM_ID
FROM ITEMS I, GRN_DETAILED G
WHERE I.ITEM_ID=G.ITEM_ID
MINUS
SELECT I.ITEM_NAME, S.ITEM_ID
FROM ITEMS I, SALES_DETAILED S
WHERE I.ITEM_ID=S.ITEM_ID;

--ALL THE SALES CONCLUDED BY PHARMACEUTISTS THAT NO LONGER WORK IN THE PHARMACY
SELECT S.*, P.*
FROM SALES S, PHARMACEUTIST P
WHERE S.PHARMACEUTIST_ID=P.PHARMACEUTIST_ID AND P.ACTIVE_STATUS='N';

--HOW MANY PRODUCTS DO WE HAVE WITH EACH VAT 
SELECT VAT_PERCENT, COUNT(ITEM_ID) NUMBER_ITEMS
FROM ITEMS
GROUP BY VAT_PERCENT
ORDER BY VAT_PERCENT DESC;

--PRODUCTS WITH THE LOWEST PRICE:
SELECT I.ITEM_NAME, GD.DETAILED_PRICE
FROM ITEMS I, GRN_DETAILED GD
WHERE I.ITEM_ID=GD.ITEM_ID
AND GD.DETAILED_PRICE=(SELECT MIN(DETAILED_PRICE)FROM GRN_DETAILED);

--INVENTORY
SELECT I.ITEM_NAME, SUM(G.QUANTITY)
FROM ITEMS I, GRN_DETAILED G
WHERE I.ITEM_ID=G.ITEM_ID
GROUP BY I.ITEM_NAME

--INCREASE SALARY WITH 8%
SELECT PHARMACEUTIST_ID, CONCAT(CONCAT(FIRST_NAME, ' '),LAST_NAME) AS PHARMACEUTIST_NAME, 
(
    CASE
    WHEN ACTIVE_STATUS='Y' THEN 1.08
    ELSE 0
    END
)*SALARY UPDATED_SALARY
FROM PHARMACEUTIST;

--DISPLAY THE CORRESPONDING TIME PERIOD (IN WEEKS) 
--BETWEEN THE PAYMENT TERM DATE AND THE CURRENT DATE:
SELECT GRN_ID, ROUND((SYSDATE-PAYMENT_TERM)/7) WEEKS FROM GRN;

--LENGTH OF THE LAST NAME, THE LENGTH OF THE FIRST NAME, IF THEY ARE EQUAL RETURN
--NULL AS A RESULT AND IF THEY ARE NOT EQUAL THE LENGTH OF THE NAME WILL BE RETURNED
SELECT LAST_NAME, LENGTH(LAST_NAME), FIRST_NAME, LENGTH(FIRST_NAME),
NULLIF(LENGTH(LAST_NAME), LENGTH(FIRST_NAME)) RESULT
FROM PHARMACEUTIST;

ALTER TABLE PATIENTS
ADD RECOMMENDED_BY_PATIENT_ID NUMBER(10);
DESCRIBE PATIENTS;

UPDATE PATIENTS
SET RECOMMENDED_BY_PATIENT_ID = 1
WHERE ID = 8;
UPDATE PATIENTS
SET RECOMMENDED_BY_PATIENT_ID = 1
WHERE ID = 11;
UPDATE PATIENTS
SET RECOMMENDED_BY_PATIENT_ID = 1
WHERE ID = 15;
UPDATE PATIENTS
SET RECOMMENDED_BY_PATIENT_ID = 8
WHERE ID = 3;
UPDATE PATIENTS
SET RECOMMENDED_BY_PATIENT_ID = 8
WHERE ID = 6;
UPDATE PATIENTS
SET RECOMMENDED_BY_PATIENT_ID = 6
WHERE ID = 29;
UPDATE PATIENTS
SET RECOMMENDED_BY_PATIENT_ID = 29
WHERE ID = 19;
UPDATE PATIENTS
SET RECOMMENDED_BY_PATIENT_ID = 8
WHERE ID = 3;

SELECT ID, FIRST_NAME, LAST_NAME, RECOMMENDED_BY_PATIENT_ID
FROM PATIENTS
CONNECT BY PRIOR ID= RECOMMENDED_BY_PATIENT_ID
START WITH ID=1;

SELECT FIRST_NAME, CONNECT_BY_ROOT FIRST_NAME RECOMMENDED_BY, LEVEL-1 RECOMMENDATION_LEVEL, SYS_CONNECT_BY_PATH (FIRST_NAME, '/') NAMES
FROM PATIENTS
CONNECT BY PRIOR ID=RECOMMENDED_BY_PATIENT_ID
START WITH ID=1;
SELECT ID, EXPIRATION_DATE, TO_CHAR((EXPIRATION_DATE),'FMDAY') "DAY"
FROM GRN_DETAILED;

--EXTRACTING 5 CHARACTERS STARTING WITH POSITION 2 FROM THE PATIENTS' NAMES
SELECT SUBSTR(LAST_NAME, 2, 5) AS EXTRACTSTRING
FROM PATIENTS; 